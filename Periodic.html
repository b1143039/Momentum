<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Periodic Motionï¼ˆé€±æœŸé‹å‹•ï¼šå½ˆç°§æŒ¯å­ï¼‰</title>

<!-- ===== Theme & Base ===== -->
<style>
:root{
  /* Dark theme (default) */
  --bg:#0b1020; --panel:#101634; --card:#131a38;
  --muted:#8fa1c5; --text:#eaf0ff; --border:rgba(255,255,255,.12);
  --brand:#6ee7ff; --brand-2:#a78bfa; --accent:#34d399; --yellow:#fde047;
  --shadow:0 12px 32px rgba(0,0,0,.35); --radius:16px;
}
:root.light{
  /* Light theme */
  --bg:#f7fafc; --panel:#ffffff; --card:#ffffff;
  --muted:#566076; --text:#0b1020; --border:rgba(0,0,0,.12);
  --brand:#06b6d4; --brand-2:#8b5cf6; --accent:#10b981; --yellow:#eab308;
  --shadow:0 10px 24px rgba(0,0,0,.08);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  font-family: ui-sans-serif, system-ui, "Segoe UI", Roboto, Arial, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei";
  background:
    radial-gradient(1200px 600px at 10% -10%, color-mix(in oklab, var(--brand-2) 30%, transparent), transparent 60%),
    radial-gradient(900px 550px at 100% 0%, color-mix(in oklab, var(--brand) 25%, transparent), transparent 60%),
    var(--bg);
}
.container{max-width:1080px;margin:0 auto;padding:28px 16px}
.card{
  background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
}
h1{margin:0;font-size:26px;letter-spacing:.2px}
.sub{color:var(--muted); font-size:14px; margin-top:6px}

/* ===== Header ===== */
.header{
  display:flex; align-items:center; justify-content:space-between; gap:14px;
  padding:16px 18px;
  background:linear-gradient(135deg, color-mix(in oklab, var(--brand) 18%, transparent), color-mix(in oklab, var(--brand-2) 20%, transparent));
}
.header-right{display:flex; align-items:center; gap:10px}
.badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.badge{
  background:color-mix(in oklab, var(--card) 60%, transparent);
  border:1px solid var(--border);
  color:var(--text); padding:4px 10px; border-radius:999px; font-size:12px; backdrop-filter: blur(4px);
}
button{
  height:36px; padding:0 14px; border-radius:10px; border:1px solid var(--border);
  background:var(--panel); color:var(--text); cursor:pointer; transition:.15s transform, .15s filter;
}
button:hover{transform:translateY(-1px); filter:brightness(1.05)}
button.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#041d26; border-color:transparent}
button.ghost{background:transparent}

/* ===== Controls ===== */
.controls{display:grid; grid-template-columns:repeat(2,minmax(260px,1fr)); gap:12px; padding:14px}
.group{border:1px dashed var(--border); border-radius:12px; padding:10px}
.group h3{margin:0 0 8px; font-size:15px; color:color-mix(in oklab, var(--text) 86%, transparent)}
.row{display:flex; gap:10px; align-items:center; padding:6px 0; flex-wrap:wrap}
label{min-width:116px; color:var(--muted); font-size:14px}
.value{width:74px; text-align:right; font-variant-numeric:tabular-nums}
input[type=range]{width:100%}
select{
  height:36px; width:100%;
  border-radius:10px; border:1px solid var(--border);
  background:color-mix(in oklab, var(--panel) 90%, var(--bg));
  color:var(--text); padding:0 10px;
}

/* ===== Sim + Readout ===== */
.grid2{display:grid; grid-template-columns:1.15fr .85fr; gap:14px; padding:12px}
.sim{padding:12px}
canvas{width:100%; height:300px; border:1px dashed var(--border); border-radius:12px; background:rgba(255,255,255,.03)}
:root.light canvas{background:#f7fafc}
.readout{padding:12px}
.kpi{
  display:grid; grid-template-columns:1fr 1fr; gap:14px 16px; align-items:center;
  font-variant-numeric:tabular-nums;
}
.kpi .item{display:flex; flex-direction:column}
.kpi .label{font-size:13.5px; color:color-mix(in oklab, var(--text) 70%, transparent)}
.kpi .value{font-size:20px; font-weight:800}
.divider{height:1px; background:var(--border); grid-column:1/-1}
.callout{
  border-left:4px solid var(--accent);
  background:color-mix(in oklab, var(--accent) 18%, transparent); padding:10px 12px; border-radius:10px; margin-top:8px; font-size:14px
}

/* ===== Tabs ===== */
.tabs{padding:12px}
.tab-list{display:flex; gap:8px; flex-wrap:wrap}
.tab-list button{
  background:transparent; border:1px solid var(--border); color:var(--muted);
  border-radius:10px; padding:8px 14px; font-size:15px; transition:.15s
}
.tab-list button[aria-selected="true"]{
  background:linear-gradient(135deg, color-mix(in oklab, var(--brand) 25%, transparent), color-mix(in oklab, var(--brand-2) 25%, transparent));
  color:var(--text); box-shadow:0 0 12px color-mix(in oklab, var(--brand) 35%, transparent)
}
.tab-panel{display:none; margin-top:10px; font-size:17px; line-height:1.8}
.tab-panel.active{display:block; animation:fade .2s ease}
@keyframes fade {from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
.formula-block{text-align:center;font-size:19px;background:color-mix(in oklab, var(--card) 70%, transparent);border:1px dashed var(--border);border-radius:10px;margin:10px 0;padding:10px}

/* ===== Footer ===== */
.footer{color:var(--muted); font-size:12px; text-align:center; padding:16px}

/* ===== Responsive ===== */
@media (max-width: 960px){
  .grid2{grid-template-columns:1fr}
  canvas{height:260px}
}
@media (prefers-color-scheme: light){
  /* å¦‚æœç³»çµ±æ˜¯æ·ºè‰²ä¸”æœªæ‰‹å‹•é¸æ“‡ï¼Œå°±ä½¿ç”¨æ·ºè‰² */
  :root:not(.dark):not(.light){ --bg:#f7fafc; }
}
</style>

<!-- MathJax -->
<script>
  window.MathJax = { tex: { inlineMath: [['\\(','\\)'], ['$', '$']] } };
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
<div class="container">

  <!-- ===== Header ===== -->
  <section class="card header" aria-label="é é¦–">
    <div>
      <h1>Periodic Motionï¼ˆé€±æœŸé‹å‹•ï¼šå½ˆç°§æŒ¯å­ï¼‰</h1>
      <p class="sub">ç°¡æ½”äº’å‹•ï¼šè§€å¯Ÿ \(x(t)\) èˆ‡èƒ½é‡å¾€è¿”ï¼Œé‡æ¸¬ \(T\) ä¸¦æ¯”è¼ƒ \(T_0=2\pi\sqrt{m/k}\)ã€‚</p>
      <div class="badges">
        <span class="badge">ç°¡è«§é‹å‹•</span><span class="badge">é˜»å°¼æ¯” \(\zeta\)</span><span class="badge">èƒ½é‡</span>
      </div>
    </div>
    <div class="header-right">
      <button id="themeBtn" class="ghost" aria-label="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“ ä¸»é¡Œ</button>
    </div>
  </section>

  <!-- ===== Controls ===== -->
  <section class="card controls" aria-label="æ§åˆ¶é¢æ¿">
    <div class="group">
      <h3>æ¨¡æ“¬æ§åˆ¶</h3>
      <div class="row">
        <button id="start" class="primary">â–¶ï¸ é–‹å§‹</button>
        <button id="pause">â¸ æš«åœ</button>
        <button id="reset">â†º é‡è¨­</button>
      </div>
      <div class="row">
        <label for="init">åˆå§‹æ¢ä»¶</label>
        <select id="init" aria-label="åˆå§‹æ¢ä»¶">
          <option value="xA_v0">ä½ç§» Aâ‚€ã€é€Ÿåº¦ 0</option>
          <option value="x0_vkick">ä½ç§» 0ã€çµ¦åˆé€Ÿ</option>
        </select>
      </div>
    </div>

    <div class="group">
      <h3>åƒæ•¸è¨­å®š</h3>
      <div class="row"><label for="m">è³ªé‡ m (kg)</label><input id="m" type="range" min="0.2" max="5" step="0.1" value="1.0"><div id="mv" class="value">1.00</div></div>
      <div class="row"><label for="k">å½ˆç°§å¸¸æ•¸ k (N/m)</label><input id="k" type="range" min="1" max="200" step="1" value="25"><div id="kv" class="value">25</div></div>
      <div class="row"><label for="c">é˜»å°¼ c (kg/s)</label><input id="c" type="range" min="0" max="20" step="0.1" value="0.2"><div id="cv" class="value">0.20</div></div>
      <div class="row"><label for="A">åˆå§‹ä½ç§» Aâ‚€ (m)</label><input id="A" type="range" min="0.05" max="0.8" step="0.05" value="0.30"><div id="Av" class="value">0.30</div></div>
    </div>
  </section>

  <!-- ===== Simulation + Readout ===== -->
  <section class="card grid2" aria-label="æ¨¡æ“¬èˆ‡è®€å€¼">
    <div class="sim">
      <canvas id="sim" width="560" height="300" aria-label="å½ˆç°§æŒ¯å­ç•«é¢"></canvas>
    </div>
    <div class="readout">
      <div class="kpi">
        <div class="item"><div class="label">Tâ‚€ï¼ˆç†è«–ï¼‰</div><div><span id="T0" class="value">â€”</span> <span style="opacity:.7">s</span></div></div>
        <div class="item"><div class="label">Tï¼ˆé‡æ¸¬ï¼‰</div><div><span id="Tm" class="value">â€”</span> <span style="opacity:.7">s</span></div></div>
        <div class="item"><div class="label">ç›¸å°èª¤å·®</div><div><span id="Terr" class="value">â€”</span> <span style="opacity:.7">%</span></div></div>
        <div class="item"><div class="label">é˜»å°¼æ¯” Î¶</div><div><span id="zeta" class="value">â€”</span></div></div>
        <div class="divider"></div>
        <div class="item"><div class="label">K å‹•èƒ½</div><div><span id="K" class="value">â€”</span> <span style="opacity:.7">J</span></div></div>
        <div class="item"><div class="label">U å½ˆç°§ä½èƒ½</div><div><span id="U" class="value">â€”</span> <span style="opacity:.7">J</span></div></div>
        <div class="item"><div class="label">E ç¸½èƒ½ï¼ˆä¸å«è€—æ•£ï¼‰</div><div><span id="E" class="value">â€”</span> <span style="opacity:.7">J</span></div></div>
        <div class="item"><div class="label">x, v</div><div><span id="xv" class="value">â€”</span></div></div>
      </div>
      <div class="callout" id="tipBox">åœ¨å°é˜»å°¼ä¸‹ï¼Œé‡æ¸¬é€±æœŸæ¥è¿‘ \(T_0=2\pi\sqrt{m/k}\)ã€‚æ”¹è®Š \(A_0\)ï¼ˆæŒ¯å¹…ï¼‰æ™‚ï¼Œé€±æœŸå¹¾ä¹ä¸è®Šã€‚</div>
    </div>
  </section>

  <!-- ===== Learning Tabs ===== -->
  <section class="card tabs" aria-label="å­¸ç¿’åˆ†é ">
    <div class="tab-list" role="tablist">
      <button role="tab" class="tab" aria-selected="true" data-tab="law">å®šå¾‹å…§å®¹</button>
      <button role="tab" class="tab" aria-selected="false" data-tab="formula">å…¬å¼è¡¨ç¤º</button>
      <button role="tab" class="tab" aria-selected="false" data-tab="diagram">åœ–åƒç†è§£</button>
      <button role="tab" class="tab" aria-selected="false" data-tab="scope">é©ç”¨ç¯„åœ</button>
      <button role="tab" class="tab" aria-selected="false" data-tab="apps">å¸¸è¦‹æ‡‰ç”¨</button>
      <button role="tab" class="tab" aria-selected="false" data-tab="quiz">æ•™å­¸å»¶ä¼¸å•é¡Œ</button>
      <button role="tab" class="tab" aria-selected="false" data-tab="ans">å»¶ä¼¸å•é¡Œè§£ç­”</button>
    </div>

    <div id="panel-law" class="tab-panel active">
      <ul>
        <li><b>ç°¡è«§æŒ¯å‹•ï¼ˆSHMï¼‰</b>ï¼šå›å¾©åŠ›èˆ‡ä½ç§»æˆæ­£æ¯”ä¸”æŒ‡å‘å¹³è¡¡é»ï¼š\(F=-kx\)ã€‚</li>
        <li><b>é˜»å°¼æŒ¯å‹•</b>ï¼šæœ‰é˜»åŠ› \(F_d=-c\,v\) æ™‚ï¼š\( m\ddot x + c\dot x + kx = 0 \)ã€‚</li>
        <li><b>é€±æœŸ</b>ï¼šå°é˜»å°¼ä¸‹ \(T\approx 2\pi\sqrt{m/k}\)ï¼Œèˆ‡æŒ¯å¹…å¹¾ä¹ç„¡é—œã€‚</li>
        <li><b>é˜»å°¼æ¯”</b>ï¼š\( \zeta=\dfrac{c}{2\sqrt{mk}} \)ï¼›\(\zeta&lt;1\) æ¬ é˜»å°¼ã€\(\zeta=1\) è‡¨ç•Œã€\(\zeta&gt;1\) éé˜»å°¼ã€‚</li>
      </ul>
    </div>

    <div id="panel-formula" class="tab-panel">
      <div class="formula-block">é‹å‹•æ–¹ç¨‹ï¼š\( m\ddot x + c\dot x + kx = 0 \)</div>
      <div class="formula-block">è‡ªç„¶è§’é »ç‡ï¼š\( \omega_0=\sqrt{k/m} \)ï¼Œç†è«–é€±æœŸ \( T_0=\dfrac{2\pi}{\omega_0}=2\pi\sqrt{m/k} \)</div>
      <div class="formula-block">èƒ½é‡ï¼š\( K=\tfrac12 m v^2,\; U=\tfrac12 k x^2,\; E=K+U \)ï¼ˆé˜»å°¼æœƒè€—ææ©Ÿæ¢°èƒ½ï¼‰</div>
      <div class="formula-block">é˜»å°¼æ¯”ï¼š\( \zeta=\dfrac{c}{2\sqrt{mk}} \)</div>
    </div>

    <div id="panel-diagram" class="tab-panel">
      <figure style="text-align:center;margin:6px 0 10px">
        <svg width="640" height="120" viewBox="0 0 640 120" role="img" aria-label="å½ˆç°§æŒ¯å­ç¤ºæ„">
          <rect x="40" y="20" width="12" height="80" fill="rgba(255,255,255,.45)"/>
          <path d="M 52 60 C 72 40, 92 80, 112 60 S 152 40, 172 60 S 212 80, 232 60 S 272 40, 292 60" fill="none" stroke="var(--brand)" stroke-width="3"/>
          <rect x="292" y="40" width="80" height="40" rx="8" fill="#f87171"/>
          <text x="332" y="64" text-anchor="middle" font-size="12" fill="#2b0c0c">m</text>
          <text x="110" y="22" font-size="12" fill="var(--brand)">k</text>
        </svg>
        <figcaption class="sub">ä½ç§» \(x\) å¾å¹³è¡¡é»é‡èµ·ï¼›å›å¾©åŠ›ç”±å½ˆç°§æä¾›ï¼Œé˜»å°¼ä½¿æŒ¯å¹…è¡°æ¸›ã€‚</figcaption>
      </figure>
    </div>

    <div id="panel-scope" class="tab-panel">
      <ul>
        <li>å°ä½ç§»ã€ç·šæ€§å½ˆç°§èˆ‡ç·šæ€§é˜»å°¼è¿‘ä¼¼æœ‰æ•ˆã€‚</li>
        <li>è‹¥å¤–åŠ›é©…å‹•ï¼ˆå—è¿«æŒ¯å‹•ï¼‰æˆ–å½ˆç°§éç·šæ€§ï¼Œéœ€ç”¨æ›´ä¸€èˆ¬æ¨¡å‹ã€‚</li>
      </ul>
    </div>

    <div id="panel-apps" class="tab-panel">
      <ul>
        <li>æ±½è»Šé¿éœ‡ï¼ˆèª¿æ•´é˜»å°¼æ¯”ä»¥æå‡èˆ’é©èˆ‡ç©©å®šï¼‰ã€‚</li>
        <li>åŠ é€Ÿåº¦æ„Ÿæ¸¬å™¨ / æ‰‹æ©Ÿé™€èºå„€çš„æ©Ÿé›»æ¨¡å‹ã€‚</li>
        <li>é˜æ“ºã€å¾®æ©Ÿæ¢°å½ˆç°§çµæ§‹ã€åœ°éœ‡éš”éœ‡ç³»çµ±ã€‚</li>
      </ul>
    </div>

    <div id="panel-quiz" class="tab-panel">
      <ol>
        <li>\(m=1.0\) kgã€\(k=25\) N/mï¼šæ±‚ \(T_0\)ã€‚</li>
        <li>åœ¨ \(\zeta=0.05\) ä¸‹é‡æ¸¬é€±æœŸ \(T\) èˆ‡ \(T_0\) æ¯”è¼ƒï¼Œèªªæ˜æ˜¯å¦èˆ‡æŒ¯å¹…ç›¸é—œã€‚</li>
        <li>èª¿æˆ \(\zeta\approx1\) èˆ‡ \(\zeta>1\)ï¼Œæè¿°ç³»çµ±å›åˆ°å¹³è¡¡çš„å·®ç•°ã€‚</li>
        <li>è‹¥ \(k\) è®Š 4 å€è€Œ \(m\) ä¸è®Šï¼Œ\(T\) æœƒå¦‚ä½•æ”¹è®Šï¼Ÿ</li>
      </ol>
    </div>

    <div id="panel-ans" class="tab-panel">
      <details open><summary><b>é¡Œ 1</b></summary>
        \(T_0=2\pi\sqrt{1/25}=2\pi/5\approx1.257\) sã€‚
      </details>
      <details><summary><b>é¡Œ 2</b></summary>
        å°é˜»å°¼ä¸‹ \(T\approx T_0\)ï¼Œèˆ‡æŒ¯å¹…å¹¾ä¹ç„¡é—œï¼ˆç­‰å¹…ç·šæ€§ç³»çµ±ï¼‰ã€‚
      </details>
      <details><summary><b>é¡Œ 3</b></summary>
        \(\zeta\approx1\)ï¼šæœ€å¿«é€Ÿä¸”ä¸æŒ¯ç›ªå›å¹³è¡¡ï¼›\(\zeta>1\)ï¼šæ›´æ…¢ã€ä¹Ÿä¸æŒ¯ç›ªã€‚
      </details>
      <details><summary><b>é¡Œ 4</b></summary>
        \(T\propto\sqrt{m/k}\)ï¼Œè‹¥ \(k\) è®Š 4 å€ï¼Œ\(T\) è®Šç‚ºåŸä¾†çš„ä¸€åŠã€‚
      </details>
    </div>
  </section>
</div>

<!-- ===== Scripts ===== -->
<script>
/* ---------- Theme toggle (dark/light with persistence) ---------- */
const root = document.documentElement;
const themeBtn = document.getElementById('themeBtn');
(function initTheme(){
  const saved = localStorage.getItem('theme'); // 'light' | 'dark' | null
  if(saved==='light') root.classList.add('light');
  else if(saved==='dark') root.classList.remove('light');
  else {
    // å¦‚æœç³»çµ±æ˜¯ lightï¼Œå°±é è¨­ light
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
      root.classList.add('light');
    }
  }
})();
themeBtn.addEventListener('click', ()=>{
  root.classList.toggle('light');
  localStorage.setItem('theme', root.classList.contains('light') ? 'light' : 'dark');
});

/* ---------- Tabs ---------- */
const tabs = document.querySelectorAll('.tab-list .tab');
const panels = {
  law: document.getElementById('panel-law'),
  formula: document.getElementById('panel-formula'),
  diagram: document.getElementById('panel-diagram'),
  scope: document.getElementById('panel-scope'),
  apps: document.getElementById('panel-apps'),
  quiz: document.getElementById('panel-quiz'),
  ans: document.getElementById('panel-ans'),
};
tabs.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabs.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    Object.values(panels).forEach(p=>p.classList.remove('active'));
    panels[btn.dataset.tab].classList.add('active');
  });
});

/* ---------- Helpers ---------- */
const $ = id => document.getElementById(id);
const fmt = n => (Math.abs(n)<1e-3? n.toExponential(1): n.toFixed(2));
function setText(id, val){ $(id).textContent = val; }

/* ---------- Controls ---------- */
const startBtn=$("start"), pauseBtn=$("pause"), resetBtn=$("reset");
const mSl=$("m"), kSl=$("k"), cSl=$("c"), ASl=$("A"), initSel=$("init");
const labels = {mv:$("mv"), kv:$("kv"), cv:$("cv"), Av:$("Av")};
function syncLabels(){
  labels.mv.textContent = (+mSl.value).toFixed(2);
  labels.kv.textContent = (+kSl.value).toFixed(0);
  labels.cv.textContent = (+cSl.value).toFixed(2);
  labels.Av.textContent = (+ASl.value).toFixed(2);
}
[mSl,kSl,cSl,ASl].forEach(s=>s.addEventListener('input', ()=>{ syncLabels(); if(!running) draw(); }));
initSel.addEventListener('change', ()=>{ if(!running) draw(); });

/* ---------- Simulation state ---------- */
const cvs = $("sim"), ctx = cvs.getContext("2d");
const pxPerMeter = 300; const wallX = 60, baseY = 160;
let running=false, raf=null;
let t=0, prevTs=null;
let x=0, v=0; // ä½ç§»(ç›¸å°å¹³è¡¡)èˆ‡é€Ÿåº¦
let lastX=0, zeroTimes=[]; // é‡æ¸¬é€±æœŸç”¨

function reset(){
  t=0; prevTs=null; zeroTimes=[];
  const A0=+ASl.value;
  if(initSel.value==="xA_v0"){ x = A0; v = 0; }
  else { x = 0; v = Math.sqrt(+kSl.value/+mSl.value)*A0; } // ä»¥è‡ªç„¶é »ç‡çµ¦åˆé€Ÿ
  lastX = x;
}

/* ---------- Physics: m x'' + c x' + k x = 0 ---------- */
function step(dt){
  const m=+mSl.value, k=+kSl.value, c=+cSl.value;
  const a = (-c*v - k*x)/m;
  v += a*dt;
  x += v*dt;
  t += dt;

  // ä¸Šè¡Œç©¿è¶Š x=0ï¼ˆéé›¶é»ï¼‰
  if(lastX<0 && x>=0 && v>0 && Math.abs(x)>1e-4){
    zeroTimes.push(t);
    if(zeroTimes.length>6) zeroTimes.shift();
  }
  lastX = x;
}

/* ---------- Drawing ---------- */
function draw(){
  const m=+mSl.value, k=+kSl.value, c=+cSl.value;
  const zeta = c/(2*Math.sqrt(m*k));
  const omega0 = Math.sqrt(k/m);
  const T0 = 2*Math.PI/omega0;

  ctx.clearRect(0,0,cvs.width,cvs.height);

  // åŸºæº–ç·šèˆ‡ç‰†
  ctx.fillStyle="rgba(255,255,255,.12)"; if(document.documentElement.classList.contains('light')) ctx.fillStyle="rgba(0,0,0,.12)";
  ctx.fillRect(wallX, baseY, cvs.width-wallX-40, 2);
  ctx.fillStyle="rgba(255,255,255,.45)"; if(document.documentElement.classList.contains('light')) ctx.fillStyle="rgba(0,0,0,.35)";
  ctx.fillRect(wallX-12, baseY-60, 12, 120);

  // ç›®æ¨™æ–¹å¡Šä½ç½®ï¼ˆé™åˆ¶ä¸æ’ç‰†/å‡ºç•«é¢ï¼‰
  const naturalLeft = wallX + 80 + x*pxPerMeter; // è‡ªç„¶é•· 80px
  const blockLeft = Math.max(wallX+40, Math.min(cvs.width-100, naturalLeft));

  // å…ˆç•«å½ˆç°§åˆ°æ–¹å¡Šå‰ 6pxï¼ˆé¿å…ç©¿æ¨¡ï¼‰
  drawSpringCoilTo(wallX, baseY, blockLeft - 6);
  // æ–¹å¡Š
  ctx.fillStyle="#f87171"; roundRect(ctx, blockLeft, baseY-30, 80, 60, 10); ctx.fill();

  // è®€æ•¸
  const K=0.5*m*v*v, U=0.5*k*x*x, E=K+U;
  let Tm="â€”", err="â€”";
  if(zeroTimes.length>=2){
    const periods=[]; for(let i=1;i<zeroTimes.length;i++) periods.push(zeroTimes[i]-zeroTimes[i-1]);
    const avg = periods.reduce((a,b)=>a+b)/periods.length; Tm=avg; err = Math.abs(Tm-T0)/T0*100;
  }
  setText("T0", fmt(T0));
  setText("Tm", Tm==="â€”"?"â€”":fmt(Tm));
  setText("Terr", err==="â€”"?"â€”":fmt(err));
  setText("zeta", fmt(zeta));
  setText("K", fmt(K)); setText("U", fmt(U)); setText("E", fmt(E));
  setText("xv", `x=${fmt(x)} m, v=${fmt(v)} m/s`);
}

function drawSpringCoilTo(wX, y, endX){
  const lead = 18, minUsable = 36, minEnd = wX + 2*lead + minUsable;
  const ex = Math.max(endX, minEnd);
  const usable = ex - (wX + 2*lead);
  const turns = Math.max(6, Math.floor(usable/22));
  const pitch = usable / turns;
  const amp = Math.max(8, Math.min(14, pitch*0.35));
  ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--brand').trim() || "#6ee7ff";
  ctx.lineWidth = 3; ctx.beginPath();
  ctx.moveTo(wX, y); ctx.lineTo(wX+lead, y);
  let x0 = wX + lead;
  for(let i=0;i<turns;i++){
    const midX = x0 + pitch/2, endSeg = x0 + pitch;
    const cy = y + (i%2===0? -amp : amp);
    ctx.quadraticCurveTo(midX, cy, endSeg, y);
    x0 = endSeg;
  }
  ctx.lineTo(ex, y); ctx.stroke();
}
function roundRect(c,x,y,w,h,r){c.beginPath();c.moveTo(x+r,y);c.arcTo(x+w,y,x+w,y+h,r);c.arcTo(x+w,y+h,x,y+h,r);c.arcTo(x,y+h,x,y,r);c.arcTo(x,y,x+w,y,r);}

/* ---------- Loop & Buttons ---------- */
function tick(ts){
  if(prevTs==null) prevTs=ts;
  const dt = Math.min(0.04, (ts-prevTs)/1000);
  prevTs = ts;
  step(dt); draw();
  raf = requestAnimationFrame(tick);
}
startBtn.addEventListener('click', ()=>{
  if(running) return; running=true; if(!raf){ prevTs=null; raf=requestAnimationFrame(tick); }
});
pauseBtn.addEventListener('click', ()=>{
  if(!running) return; running=false; cancelAnimationFrame(raf); raf=null;
  $("tipBox").textContent = "å·²æš«åœã€‚å¯èª¿æ•´åƒæ•¸å¾Œå†é–‹å§‹ã€‚";
});
resetBtn.addEventListener('click', ()=>{
  running=false; cancelAnimationFrame(raf); raf=null; reset(); draw();
  $("tipBox").textContent = "å·²é‡è¨­ã€‚é»ã€Œé–‹å§‹ã€å•Ÿå‹•æ¨¡æ“¬ã€‚";
});

/* ---------- Init ---------- */
syncLabels(); reset(); draw();
</script>
</body>
</html>
